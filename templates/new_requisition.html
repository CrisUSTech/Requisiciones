{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-bold mb-4">Nueva Requisición</h2>

<form method="post">
  <div class="grid grid-cols-2 gap-4 mb-4">
    <div>
      <label>Fecha de mantenimiento</label>
      <input type="date" name="fecha_mantenimiento"
             class="border p-2 w-full" required>
    </div>
    <div>
      <label>Prioridad</label>
      <select name="prioridad" class="border p-2 w-full">
        <option value="Alta">Alta</option>
        <option value="Media" selected>Media</option>
        <option value="Baja">Baja</option>
      </select>
    </div>
  </div>

  <div class="mb-4">
    <label>Proyecto / Tema</label>
    <input type="text" name="proyecto" class="border p-2 w-full" required>
  </div>

  <div class="mb-4">
    <label>Utilización</label>
    <textarea name="utilizacion" class="border p-2 w-full"></textarea>
  </div>

  <h3 class="font-semibold mb-2">Materiales</h3>

  <table class="w-full border mb-3" id="tabla-materiales">
    <thead>
      <tr class="bg-gray-100">
        <th class="border p-2">Descripción</th>
        <th class="border p-2">Unidad</th>
        <th class="border p-2">Cantidad</th>
        <th class="border p-2">Acción</th>
      </tr>
    </thead>
    <tbody id="tbody-materiales">
      <tr>
        <td class="border p-1">
          <input type="text" name="desc[]" class="border p-1 w-full" required>
        </td>
        <td class="border p-1">
          <input type="text" name="unidad[]" class="border p-1 w-full" value="PZA" required>
        </td>
        <td class="border p-1">
          <input type="number" name="cant[]" class="border p-1 w-full" value="1" min="1" required>
        </td>
        <td class="border p-1 text-center">
          <button type="button" class="text-red-600" onclick="eliminarFila(this)">Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>

  <button type="button" onclick="agregarFila()"
          class="mb-4 bg-blue-600 text-white px-3 py-1 rounded">
    Agregar material
  </button>

  <div>
    <button type="submit"
            class="bg-green-600 text-white px-4 py-2 rounded">
      Guardar Requisición
    </button>
  </div>
</form>

<script>
function agregarFila() {
  const tbody = document.getElementById('tbody-materiales');
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td class="border p-1">
      <input type="text" name="desc[]" class="border p-1 w-full" required>
    </td>
    <td class="border p-1">
      <input type="text" name="unidad[]" class="border p-1 w-full" value="PZA" required>
    </td>
    <td class="border p-1">
      <input type="number" name="cant[]" class="border p-1 w-full" value="1" min="1" required>
    </td>
    <td class="border p-1 text-center">
      <button type="button" class="text-red-600" onclick="eliminarFila(this)">Eliminar</button>
    </td>`;
  tbody.appendChild(tr);
}

function eliminarFila(btn) {
  const tr = btn.closest('tr');
  const tbody = document.getElementById('tbody-materiales');
  if (tbody.rows.length > 1) {
    tr.remove();
  }
}
</script>
{% endblock %}